{"version":3,"sources":["index.js"],"names":["activateTodoApp","appId","classNames","generateTodoEl","app","document","getElementById","Error","concat","findComponent","className","node","querySelector","components","$todos","$addInput","$addButton","$clearButton","$remainCount","renderRemainCount","textContent","children","length","toString","add","storage","_JSON$parse","JSON","parse","localStorage","getItem","_unused","newTodos","setItem","stringify","syncStorage","_ref","type","payload","todos","newTodo","_toConsumableArray","filter","todo","id","fragment","createDocumentFragment","forEach","_ref2","content","appendChild","prepend","value","trim","_window$crypto","cryptoObj","biteArray","window","crypto","msCrypto","Uint32Array","getRandomValues","addEventListener","e","key","isComposing","event","target","classList","contains","$deleteButton","closest","$todo","remove","innerHTML","li","createElement","p","button","append"],"mappings":"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","file":"todo-app-assignment.43d94edc.js","sourceRoot":"..","sourcesContent":["/**\n * @typedef {Object} TodoRaw\n * @property {string} id\n * @property {string} content\n */\n/**\n * @typedef {Object} ClassNames\n * @property {string} $todos\n * @property {string} $todo\n * @property {string} $addInput\n * @property {string} $addButton\n * @property {string} $deleteButton\n * @property {string} $clearButton\n * @property {string} $remainCount\n */\n/**\n * @typedef {function} generateTodoEl\n * @param {string} content\n * @return {HTMLElement}\n */\n/**\n * @param {string} appId - components classNames\n * @param {ClassNames} classNames - components classNames\n * @param {generateTodoEl} generateTodoEl - todo element generator\n */\nfunction activateTodoApp(appId, classNames, generateTodoEl) {\n  const app = document.getElementById(appId);\n\n  if (!app) {\n    throw new Error(`App node that maps to id \"${appId}\" not found.`);\n  }\n\n  function findComponent(className) {\n    const node = app.querySelector(`.${className}`);\n\n    if (!node) {\n      throw new Error(`Component node that maps to className \"${className}\" not found.`);\n    }\n\n    return node;\n  }\n\n  const components = {\n    $todos: findComponent(classNames.$todos),\n    $addInput: findComponent(classNames.$addInput),\n    $addButton: findComponent(classNames.$addButton),\n    $clearButton: findComponent(classNames.$clearButton),\n    $remainCount: findComponent(classNames.$remainCount),\n  };\n\n  function renderRemainCount() {\n    components.$remainCount.textContent = components.$todos.children.length.toString();\n  }\n\n  const storage = {\n    get todos() {\n      try {\n        return JSON.parse(localStorage.getItem(appId)) ?? [];\n      } catch {\n        return [];\n      }\n    },\n    set todos(newTodos) {\n      localStorage.setItem(appId, JSON.stringify(newTodos));\n    },\n  };\n\n  function syncStorage({ type, payload }) {\n    switch (type) {\n      case 'add':\n        storage.todos = [payload.newTodo, ...storage.todos];\n        break;\n      case 'remove':\n        storage.todos = storage.todos.filter(todo => todo.id !== payload.id);\n        break;\n      case 'clear':\n        storage.todos = [];\n        break;\n      case 'initialize':\n        const fragment = document.createDocumentFragment();\n        storage.todos.forEach(({ id, content }) => {\n          const todo = generateTodoEl(content);\n          todo.id = id;\n          fragment.appendChild(todo);\n        });\n        components.$todos.prepend(fragment);\n        break;\n      default:\n        throw new Error(`Invalid syncStorage type: \"${type}\"`);\n    }\n  }\n\n  function attachAddHandlers() {\n    const generateId = () => {\n      const cryptoObj = window.crypto ?? window.msCrypto; /* ie11 */\n      const biteArray = new Uint32Array(1);\n\n      return cryptoObj.getRandomValues(biteArray)[0].toString();\n    };\n\n    const add = () => {\n      const content = components.$addInput.value.trim();\n      if (!content) return;\n\n      const id = generateId();\n      const todo = generateTodoEl(content);\n      todo.id = id;\n\n      components.$todos.prepend(todo);\n      syncStorage({\n        type: 'add',\n        payload: { newTodo: { id, content } },\n      });\n\n      components.$addInput.value = '';\n      renderRemainCount();\n    };\n\n    components.$addButton.addEventListener('click', add);\n    components.$addInput.addEventListener('keydown', e => {\n      if (e.key === 'Enter' && !e.isComposing) {\n        add();\n      }\n    });\n  }\n\n  function attachDeleteHandler() {\n    components.$todos.addEventListener('click', event => {\n      if (!event.target.classList.contains(classNames.$deleteButton)) return;\n\n      const todo = event.target.closest(`.${classNames.$todo}`);\n      if (!todo) return;\n\n      todo.remove();\n      syncStorage({\n        type: 'remove',\n        payload: { id: todo.id },\n      });\n      renderRemainCount();\n    });\n  }\n\n  function attachClearAllHandler() {\n    components.$clearButton.addEventListener('click', () => {\n      components.$todos.innerHTML = '';\n      components.$addInput.value = '';\n      syncStorage({ type: 'clear' });\n      renderRemainCount();\n    });\n  }\n\n  syncStorage({ type: 'initialize' });\n  attachAddHandlers();\n  attachDeleteHandler();\n  attachClearAllHandler();\n  renderRemainCount();\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  /** @type {ClassNames} */\n  const classNames = {\n    $todos: 'todos',\n    $todo: 'todo',\n    $addButton: 'add-button',\n    $addInput: 'add-input',\n    $deleteButton: 'delete-button',\n    $clearButton: 'clear-button',\n    $remainCount: 'remain-tasks-count',\n  };\n\n  /** @type {generateTodoEl} */\n  const generateTodoEl = content => {\n    const li = document.createElement('li');\n    li.className = classNames.$todo;\n\n    const p = document.createElement('p');\n    p.textContent = content;\n\n    const button = document.createElement('button');\n    button.className = classNames.$deleteButton;\n\n    li.append(p, button);\n    return li;\n  };\n\n  activateTodoApp('todoApp', classNames, generateTodoEl);\n});\n"]}